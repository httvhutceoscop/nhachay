!function(a){Drupal.behaviors.nhachay={attach:function(){function t(t,n,e,i,o,s,c){var d=u+"/"+n+"/"+e;f=c,f++,a(".i-large-play").removeClass("pause"),p=!0,a("#sourceId").attr("src",d),a("#play-section").show(),a("#footer").css("margin-bottom","92px"),a(".music-name").html(i),a(".singer-name").html(o),a(h).trigger("load"),a(h).trigger("play"),a(".remain-time").html("00:00"),a(".total-time").html("00:00"),r(),"nhac_so"==s&&a.ajax({type:"POST",url:l+"api/listen",data:{from_js:!0,node_id:t},dataType:"json",success:function(a){a.message&&console.log(a.message)},error:function(a){alert("An error occurred: "+a.status)}})}function n(){f++,console.log("next currentId:"+f);var n=a(".node-wrap").length;if(console.log("length_node_wrap:"+n),n>=f){var e=a(".node-wrap."+f+" .i-listen"),i=e.data("name"),o=e.data("provider"),r=e.data("file"),s=e.data("singer"),c=e.data("nid"),d=e.data("type"),l=e.data("order");t(c,o,r,i,s,d,l)}}function e(){if(h.buffered.length>0){var t=h.buffered.end(0)/h.duration*100;a("#load_progress").css({width:t+"%"})}}function i(a){{var t=a;Math.floor(t/3600)}t%=3600;var n=Math.floor(t/60);return t=Math.floor(t%60),t.toString().length<2&&(t="0"+t),n.toString().length<2&&(n="0"+n),n+":"+t}function o(){a(".remain-time").html(i(h.currentTime)),a(".total-time").html(i(h.duration))}function r(){var t=document.getElementById("audioId"),e=setInterval(function(){t.ended&&(a(".i-large-play").addClass("pause"),p=!1,n(),clearInterval(e))},1e3)}function s(){var t=a('input[name="search"]').val();""!=t.trim()&&window.location.assign(window.location.origin+"/search/node/"+t)}function c(a,t){var n=document.createElement("a");n.href=a,n.target="_blank",n.download=t||a;var e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});n.dispatchEvent(e),(window.URL||window.webkitURL).revokeObjectURL(n.href)}function d(){var t=a("#popUpTip");a(t).fadeIn(300);var n=(a(t).height()+24)/2,e=(a(t).width()+24)/2;a(t).css({"margin-top":-n,"margin-left":-e}),a("body").append('<div id="mask"></div>'),a("#mask").fadeIn(300),a(".cancel, #mask").click(function(t){return t.preventDefault(),a("#mask, .popup_tip").fadeOut(300,function(){a("#mask").remove(),a(".popup_tip").remove()}),!1})}var l=Drupal.settings.nhachayhomnay.root_path,p=!0,u="http://mp3.homnay24h.com",h=document.getElementById("audioId"),f=0;a(".i-listen").each(function(t){t=10>t?"0"+t:t,a(this).attr("data-order",t)}),a(".node-wrap").each(function(t){a(this).addClass((t+1).toString())}),a(".i-listen").click(function(){var n=(a(this),a(this).data("name")),e=a(this).data("provider"),i=a(this).data("file"),o=a(this).data("singer"),r=a(this).data("nid"),s=a(this).data("type"),c=a(this).data("order"),d=u+"/"+e+"/"+i;console.log(d);a(".i-listen").index(this);t(r,e,i,n,o,s,c)}),a(".i-large-play").click(function(){var t=a("#audioId");p?(a(this).addClass("pause"),p=!1,t.trigger("pause")):(a(this).removeClass("pause"),p=!0,t.trigger("play"),r())}),a(h).bind("timeupdate",function(){var t=this.currentTime/this.duration*100;a("#play_progress").css({width:t+"%"}),o()}),a(h).bind("progress",function(){e()}),a(h).bind("loadeddata",function(){e()}),a(h).bind("canplaythrough",function(){e()}),a(h).bind("playing",function(){e()}),a(h).bind("durationchange",function(){}),a("#progress").bind("click",function(t){var n=a(this).offset(),e=t.pageX-n.left,i=(t.pageY-n.top,a(this).width()),o=e/i*100,r=o*h.duration/100;h.currentTime=r,h.paused&&(a(".i-large-play").removeClass("pause"),a(h).trigger("play"))}),a("#btn-search").click(function(t){t.preventDefault();var n=a('input[name="search"]').val();""!=n?s():console.log("key_word")}),a('input[name="search"]').keypress(function(a){13==a.which&&(console.log("go enter"),s())}),a(".t-singer").click(function(){var t=a(this).html();""!=t.trim()&&window.location.assign(window.location.origin+"/search/node/"+t)}),a(".dl_nhac_so").click(function(){var t=a(this).data("file"),n=u+"/nhacso/"+t;""!=t?(t=n.substring(n.lastIndexOf("/")+1).split("?")[0],c(n,t)):alert("File not found")}),a(".dl_nhac_cho").click(function(){var t=a(this).data("number"),n=a(this).data("code"),e=n.split(" "),i=a(this).data("name");console.log(t+n+i),a("body").append('<div id="popUpTip" class="popup_tip"> <div class="tip"> <p>Để cài đặt bài hát yêu thích</p> <p><strong>'+i+'</strong></p> <p class="cu_phap"> SOẠN: <span>'+e[0]+" "+e[1]+"</span> GỬI <span>"+t+'</span> </p> </div> <div class="tip_submit"> <a class="send" href="sms:'+t+"?body="+e[0]+" "+e[1]+'">Gửi</a> <a class="cancel" href="#">Hủy</a> </div> </div>'),d()})}}}(jQuery);